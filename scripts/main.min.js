function getPageParameter(){for(var e=window.location.search.substring(1).split("&"),t=0,n=e.length;n>t;t++){var o=e[t].split("=");if("p"===o[0])return o[1]}}function copyURL(){if($(this).hasClass("end_screen"))var e=$(".url_text.end_screen");else var e=$(".url_text.share_screen");e.focus(),e.select(),document.execCommand("copy"),$(".copy_tooltip_text").text("Copied!")}function pageFoundAction(e){$DOC.data("wikiPageTitle",new TitleObject(e.title)),$DOC.data("wikiPageId",e.pageid),$DOC.data("wikiPageURL",e.fullurl);var t=encodeURI(window.location.protocol+"//"+window.location.host+window.location.pathname+"?p="+e.pageid);$(".url_text").val(t),prepareOverlay(e),initializeCounters()}function openCard(){nukeStyles(),isGridActive()&&$(".menu_clip").addClass("slid"),$(".card").addClass("slid"),$(".card_overlay").addClass("selected"),$(".card_clip").addClass("higherZIndex")}function closeCard(){$(".card_overlay").removeClass("selected"),setTimeout(function(){$(".card_message").removeClass("selected")},400),$(".card, .menu_clip").removeClass("slid"),$(".card_clip").removeClass("higherZIndex")}function prepareOverlay(e){$(".page_link").attr("href",e.fullurl).prepend("<span>How to "+e.title+"</span>")}function isGridActive(){return"none"!==$(".trim").css("display")}function resizeAction(){var e=$(".panel.game");gDiff=$DOC.scrollTop()+$(window).height()-($DOC.height()-$(".page_footer").height()),$DOC.data("fixedFloatWidth",e.width()),$DOC.data("fixedFloatLeft",e.offset().left),scrollAction(),isGridActive()?gMobileLayout&&(gMobileLayout=!1,nukeStyles()):gMobileLayout||(gMobileLayout=!0,nukeStyles())}function nukeStyles(){if(0===styles2Nuke.length){var e=$(".widget_header");styles2Nuke.push($(".history_log"),$(".menu_clip"),$(".sliding_up_mobile"),e,e.find("i"),e.find(".band"),$(".guessSection"),$(".spacie"))}for(var t=styles2Nuke.length;0>=t;t--)styles2Nuke[t].removeAttr("style");$(".answer").css("box-shadow",""),$(".toggle").removeAttr("checked")}function scrollAction(){if($(document.activeElement).hasClass("gb")&&$(document.activeElement).blur(),isGridActive()){if(!gFirstScroll)return gFirstScroll=!0,void resizeAction();var e=$(".game.panel"),t=$(".history_log"),n=$(".menu_clip"),o=$(".answer"),a=$(window).scrollTop()-(e.offset().top+e.height());closeCard(),gDiff=$(window).scrollTop()+$(window).height()-$(".page_footer").offset().top,gDiff>0?o.add(n).css({bottom:gDiff}):o.add(n).css({bottom:0}),a>0?($(".spacie").css({position:"relative"}),t.css({"max-height":o[0].getBoundingClientRect().top-t[0].getBoundingClientRect().top-30}),n.css({position:"fixed",width:$DOC.data("fixedFloatWidth"),top:20,left:$DOC.data("fixedFloatLeft")}),n.find(".panel").css({"box-shadow":"0 0 8px rgba(0, 0, 0, 0.16)"})):(n.css({position:"",width:"",top:"",left:"","box-shadow":""}),n.find(".panel").css({"box-shadow":""}),$(".spacie").css({position:"absolute",height:n.outerHeight(!0)}))}}function gPanelButtonPressedAction(){$(".card_message").removeClass("selected");var e=$(this);return"rules"===e.attr("id")?void overlayAction("rules"):("giveup"===e.attr("id")?$(".giveup_confirmation").addClass("selected"):"restart"===e.attr("id")?$(".restart_confirmation").addClass("selected"):"share"===e.attr("id")&&$(".sharingsux").addClass("selected"),void openCard())}function disable(e){return e.attr("disabled","true")}function enable(e){return e.removeAttr("disabled")}function TitleObject(e){this.origString=e,this.origTokens=e.match(/\S+/g),this.normTokens=diacritics2url.replaceDiacritics(e.toLowerCase().replace(STD_PUNCT,"")).match(/\S+/g),this.wordTokens=e.replace(SEP_PUNCT,"").match(/\S+/g),this.guessed=zeroArray(this.origTokens.length)}function slide(){var e=$(this),t=$(".widget_header"),n=t.add(".guessSection"),o=$(".answer"),a=$(".menu_clip"),i=$(".top_header"),s=t.find("i"),r=t.find(".band"),l=$(".sliding_up_mobile");l.css({transform:"translate(0,0)"}),e.prop("checked")?(closeCard(),a.css({"z-index":1}),i.css({"z-index":1}),l.css({transform:"translate(0,-"+$(".menu").height()+"px)"}),s.css({transform:"rotate(180deg)"}),r.css({"border-bottom":"none"}),n.css({"box-shadow":"0 0 10px rgba(0, 0, 0, 0.16)"}),o.css({"box-shadow":"none"})):(l.animate({transform:"translate(0,0)"},500,"swing",function(){n.css({"box-shadow":"none"}),o.css({"box-shadow":"0 0 10px rgba(0, 0, 0, 0.16)"}),a.add(i).removeAttr("style")}),s.css({transform:"rotate(0deg)"}),r.css({"border-bottom":".5px solid #8a8a89"}))}function openOverlay(){$(".overlay").height("100%")}function closeOverlay(){$(".overlay").height("0")}function asyncQueryForRandomUsablePage(e){var t,e=e||null;return t=null!=e?"https://www.wikihow.com/api.php?action=query&format=json&prop=info%7Cimages&pageids="+e+"&inprop=url&imlimit=100":"https://www.wikihow.com/api.php?action=query&format=json&prop=info%7Cimages&generator=random&inprop=url&imlimit=100&grnnamespace=0#",$.ajax({url:t,dataType:"jsonp"}).then(function(e){var t=e.query.pages[Object.keys(e.query.pages)[0].toString()];return console.log(t),console.log(t.fullurl),console.log(t.images),filterUnusableImages(t.images),null==t.images||t.images.length<MIN_PAGE_IMAGES||t.title.length>256?asyncQueryForRandomUsablePage():t})}function asyncQueryForPageImages(e){return $.ajax({url:synthImageInfoQuery(e.images),dataType:"jsonp"}).then(function(e){for(var t=[],n=Object.keys(e.query.pages),o=0;o<n.length;o++)if(n[o]>0){var a=e.query.pages[n[o].toString()];t.push(a)}return t})}function addImageToDocument(){var e=$DOC.data("undisplayedImages");if(0!==e.length){var t=$(".wrap"),n=Math.floor(Math.random()*e.length),o=e[n].imageinfo[0];e.splice(n,1);var a=getNewImageHtml(o);t.append(a),incrementCounter("numImageHints"),$(a.find("img")[0]).unveil(0,function(){$(this).load(function(){scrollAction()})}),e.length<1&&disable($(this))}else disable($(this))}function giveWordHint(){console.log("lol");for(var e=$DOC.data("wikiPageTitle"),t=[],n=e.normTokens.length-1;n>=0;n--)0===e.guessed[n]&&t.push(n);if(t.length>=1){var o=Math.floor(Math.random()*t.length);e.guessed[t[o]]++,incrementCounter("numWordHints"),addNewGoodWords(makeWordNode(e.wordTokens[t[o]]),"slow"),1===t.length&&disable($(this))}else disable($(this))}function addImagesToDocument(e,t){var n=$(".wrap");$DOC.data("undisplayedImages",e);for(var o=0;NUM_INITIAL_IMAGES>o&&0!==e.length;o++){var a=Math.floor(Math.random()*e.length),i=e[a].imageinfo[0];e.splice(a,1);var s=getNewImageHtml(i);n.append(s),$(s.find("img")[0]).unveil(0,function(){$(this).load(function(){scrollAction()})})}}function getNewImageHtml(e){var t=$('<div class="box_wrapper floatyWrapper row"></div>'),n=$('<img class="pageImage u-max-full-width" src="/images/ring.gif"/>');return t.resize(function(){console.log("HEYYYY"),resizeAction()}),n.attr("data-src",e.url),t.append(n)}function focusedAction(){var e=$(this);e.css({color:"#222","font-style":"normal"}),e.val()===DEFAULT_INPUT_MESSAGE&&e.val("")}function keyupAction(){""!==$(this).val()?enable($(".guessSubmit")):disable($(".guessSubmit"))}function blurAction(){var e=$(this);""!==e.val()?enable($(".guessSubmit")):(e.val(DEFAULT_INPUT_MESSAGE),e.css({color:"#8a8a89","font-style":"italic"}),disable($(".guessSubmit")))}function submitAction(){var e=($(".menu"),$(".textField").val()),t=new TitleObject(e.replace(/^\s*how\s+to\s+/gi,""));$DOC.data("wikiPageTitle");isGridActive()?updateMenu(t,"slow","slow")&&overlayAction("win"):updateMenuMobile(t,"slow","slow")&&overlayAction("win"),$(".textField").val("")}function overlayAction(e){makeOverlay(e),openOverlay()}function makeOverlay(e){var t=$(".overlay_info_wrapper"),n=t.find(".overlay_info"),o=$(".win_screen");switch(n.hide(),t.removeClass("contains_attribs").removeClass("contains_win_screen").removeClass("contains_rules_screen"),e){case"win":$(".score").show(),t.addClass("contains_win_screen"),o.show().find("h2").text("Yep!"),o.find("h2 + h6").html("<i>Of course</i> we're learning");var a=$(".contains_win_screen");a.css({top:($(window).height()-a.outerHeight(!0))/2});break;case"loss":$(".score").hide(),t.addClass("contains_win_screen"),o.show().find("h2").text("¯\\_(ツ)_/¯"),o.find("h2 + h6").html("We were clearly going for");var a=$(".contains_win_screen");a.css({top:($(window).height()-a.outerHeight(!0))/2});break;case"about":t.addClass("contains_attribs"),$(".attribs").show();break;case"rules":t.addClass("contains_rules_screen"),$(".rules_screen").show()}}function initializeCounters(){$(".counter").data("num",0),$("#numImageHints").data("num",NUM_INITIAL_IMAGES),$("#numImageHints").data("labelInfo",["image","images"]),$("#numWordHints").data("labelInfo",["hint","hints"]),$(".numGuesses").data("labelInfo",["try","tries"]),$("#numWords").data("outof",$DOC.data("wikiPageTitle").normTokens.length),$(".counter").text("0"),$("#numImageHints").text(NUM_INITIAL_IMAGES),$("#numWords").text("(0/"+$("#numWords").data("outof")+")")}function incrementCounter(e){var t="numGuesses"===e?$("."+e):$("#"+e),n=t.data("num");if(t.data("num",n+1),t.text(n+1),"numWords"===e){var o=t.data("outof");n+1!==0&&$(".empty_message").remove(),t.text("("+(n+1)+"/"+o+")")}var a=t.data("labelInfo");if(a){var i=$("#"+e+"_label");n+1===1?i.text(a[0]):n+1===2&&i.text(a[1])}}function insertableElementClickAction(){var e=$(".textField");e.focus(),""===e.val()?e.val($(this).text().trim()):e.val(e.val()+" "+$(this).text().trim())}function updateMenu(e,t,n){var o=getNewMenuHtml(e,$DOC.data("wikiPageTitle"));return addNewGoodWords(o.words,n),addNewGuessHistory(o.hist,t,n),o.win}function updateMenuMobile(e,t,n){return $(".toggle").prop("checked")||$(".toggle").trigger("click"),updateMenu(e,t,n)}function getNewMenuHtml(e,t){for(var n=$('<div class="guess_container"><div class="inner menuText"></div></div><hr>'),o=n.find(".inner"),a=[],i="",s=e.normTokens.length===t.normTokens.length,r=0;r<e.normTokens.length;r++)for(var l=0;l<t.normTokens.length;l++){if(r===l&&e.normTokens[r]!==t.normTokens[l]&&(s=!1),e.normTokens[r]===t.normTokens[l]){o.append(document.createTextNode(i)),i="";var d=$("<em></em>").text(e.origTokens[r].trim()+" ");d.click(insertableElementClickAction),o.append(d),0===t.guessed[l]&&a.push(makeWordNode(t.origTokens[l])),e.guessed[r]++,t.guessed[l]++;break}l===t.normTokens.length-1&&(i=i+e.origTokens[r]+" ")}return o.append(document.createTextNode(i)),{words:a.reverse(),hist:n,win:s}}function addNewGuessHistory(e,t,n){incrementCounter("numGuesses"),$(".empty_message_hist").remove(),$(e).hide().prependTo(".history_log").slideDown(t).fadeIn(n)}function addNewGoodWords(e,t){for(var n=e.length-1;n>=0;n--)$(e[n]).hide().appendTo(".good_words").fadeIn("fadeDuration"),incrementCounter("numWords")}function makeWordNode(e){var t=$('<div class="selectable_container"><span class="word menuText"></span></div>'),n=t.find(".word")[0];return $(n).text(e),$(n).click(insertableElementClickAction),t}function zeroArray(e){for(var t=new Array(e);--e>=0;)t[e]=0;return t}function isUnusableImage(e){for(var t=UNUSABLE_IMAGES.length-1;t>=0;t--)if(UNUSABLE_IMAGES[t]===e)return!0;return!1}function filterUnusableImages(e){if(null!=e)for(var t=e.length-1;t>=0;t--)isUnusableImage(e[t].title)&&e.splice(t,1)}function synthImageInfoQuery(e){for(var t="https://www.wikihow.com/api.php?action=query&format=json&prop=imageinfo&titles=",n=0;n<e.length;n++)t+=e[n].title,t+=n<e.length-1?"%7C":"&iiprop=url%7Csize&iiurlwidth=500";return t=t.replace(/ /g,"+")}var STD_PUNCT=/[\'!"#$%&()*+,\-.\/:;<=>?@\[\]^_`{|}~]/g,SEP_PUNCT=/["(),<>?@\[\]_{}]/g,NUM_INITIAL_IMAGES=2,MIN_PAGE_IMAGES=4,DEFAULT_INPUT_MESSAGE="How to...",$DOC=$(document),linkedPageId=getPageParameter(),promisedUsablePage=asyncQueryForRandomUsablePage(linkedPageId),gFirstScroll=!1,gDiff=0,gMobileLayout=!isGridActive(),styles2Nuke=[];$.when(promisedUsablePage.then(asyncQueryForPageImages),$DOC.data("readyDeferred")).done(addImagesToDocument),$DOC.data("readyDeferred",$.Deferred()).ready(function(){var e=$(".textField"),t=$(".toggle"),n=$(".game.panel");$.when(promisedUsablePage).done(pageFoundAction),$DOC.data("readyDeferred").resolve(),$DOC.data("fixedFloatWidth",n.width()),$DOC.data("fixedFloatLeft",n.offset().left),$(window).scroll(scrollAction),$(window).resize(resizeAction),$DOC.resize(resizeAction);var o=$(".gb");o.click(gPanelButtonPressedAction),$("#imagehint").click(addImageToDocument),$("#wordhint").click(giveWordHint),$(".card_overlay, button.card_close").click(closeCard),e.focus(focusedAction),e.keyup(keyupAction),e.blur(blurAction),t.change(slide),$(".close_link").click(closeOverlay),$(".copy_link").click(copyURL),$(".about").click(function(){overlayAction("about")}),$(".card_giveup").click(function(){overlayAction("loss")})});
//# sourceMappingURL=main.min.js.map
